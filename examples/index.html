



<!doctype html>
<html lang="en" class="no-js">
  <head>
    

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="The package-based application launcher">
      
      
        <link rel="canonical" href="https://allspark.sh/examples/">
      
      
        <meta name="author" content="mottosso">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
<link href="https://fonts.googleapis.com/css?family=Roboto:400,500|Source+Code+Pro" rel="stylesheet">

    
      
        <title>Examples - Allspark</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="white">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#examples" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://allspark.sh" title="Allspark" class="md-header-nav__button md-logo">
          
            <img src="../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Allspark
            </span>
            <span class="md-header-nav__topic">
              
                Examples
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/mottosso/allspark/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    mottosso/allspark
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://allspark.sh" title="Allspark" class="md-nav__button md-logo">
      
        <img src="../logo.png" width="48" height="48">
      
    </a>
    Allspark
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/mottosso/allspark/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    mottosso/allspark
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../guides/" title="Guide" class="md-nav__link">
      Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reference/" title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rez/" title="Packaging" class="md-nav__link">
      Packaging
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Examples
      </label>
    
    <a href="./" title="Examples" class="md-nav__link md-nav__link--active">
      Examples
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-shorthand" title="Command Shorthand" class="md-nav__link">
    Command Shorthand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-packages" title="External Packages" class="md-nav__link">
    External Packages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-from-pypi" title="Install from PyPI" class="md-nav__link">
    Install from PyPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-from-scoop" title="Install from Scoop" class="md-nav__link">
    Install from Scoop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-gotchas" title="Windows Gotchas" class="md-nav__link">
    Windows Gotchas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alias-on-windows-with-cmd" title="alias() on Windows with cmd" class="md-nav__link">
    alias() on Windows with cmd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-tree" title="Process Tree" class="md-nav__link">
    Process Tree
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmd-and-2000-characters" title="cmd and 2,000 characters" class="md-nav__link">
    cmd and 2,000 characters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform_map" title="platform_map" class="md-nav__link">
    platform_map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maya-and-quicktime" title="Maya and Quicktime" class="md-nav__link">
    Maya and Quicktime
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-version-and-python" title="Package version and Python" class="md-nav__link">
    Package version and Python
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-package-to-python" title="1. Package to Python" class="md-nav__link">
    1. Package to Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-embedded" title="2. Embedded" class="md-nav__link">
    2. Embedded
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../shells/" title="Shells" class="md-nav__link">
      Shells
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-shorthand" title="Command Shorthand" class="md-nav__link">
    Command Shorthand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-packages" title="External Packages" class="md-nav__link">
    External Packages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-from-pypi" title="Install from PyPI" class="md-nav__link">
    Install from PyPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-from-scoop" title="Install from Scoop" class="md-nav__link">
    Install from Scoop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-gotchas" title="Windows Gotchas" class="md-nav__link">
    Windows Gotchas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alias-on-windows-with-cmd" title="alias() on Windows with cmd" class="md-nav__link">
    alias() on Windows with cmd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-tree" title="Process Tree" class="md-nav__link">
    Process Tree
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmd-and-2000-characters" title="cmd and 2,000 characters" class="md-nav__link">
    cmd and 2,000 characters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform_map" title="platform_map" class="md-nav__link">
    platform_map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maya-and-quicktime" title="Maya and Quicktime" class="md-nav__link">
    Maya and Quicktime
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-version-and-python" title="Package version and Python" class="md-nav__link">
    Package version and Python
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-package-to-python" title="1. Package to Python" class="md-nav__link">
    1. Package to Python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-embedded" title="2. Embedded" class="md-nav__link">
    2. Embedded
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
<small class="modified-date"><br><i>Updated 2019-07-08</i></small>

                
                  <a href="https://github.com/mottosso/allspark/edit/master/docs/pages/examples.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Examples</h1>
                
                <p>Learn Allspark by example. This assumes you've already accumulated the knowledge from the <a href="../guides">guides</a> chapter.</p>
<p><br></p>
<h2 id="examples">Examples</h2>
<p>This page contains a series of solutions to specific problems.</p>
<p><br></p>
<h3 id="command-shorthand">Command Shorthand</h3>
<p><img width=381 src=https://user-images.githubusercontent.com/2152766/60725113-2e90d100-9f30-11e9-9fe5-866e7038a3fa.png></h3></p>
<p>Use <code>rez env</code> to establish a context, and <code>--command</code> to immediately run a command within that context.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">rez</span> <span style="color: #f8f8f2">env</span> <span style="color: #f8f8f2">--command=</span><span style="color: #e6db74">&quot;echo Hello&quot;</span>
</pre></div>

<p>Instead of using <code>--command</code>, you can also use <code>--</code>.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">rez</span> <span style="color: #f8f8f2">env</span> <span style="color: #f8f8f2">--</span> <span style="color: #f8f8f2">echo Hello</span>
</pre></div>

<p>Note that you didn't need quotation marks or an <code>=</code> sign for this to work, and that it's a little easier on the eyes. We use this syntax extensively throughout this guide.</p>
<p><br></p>
<h2 id="external-packages">External Packages</h2>
<p>With Rez you can package almost anything, but sometimes there are packages already made for you to benefit from.</p>
<p><br></p>
<h3 id="install-from-pypi">Install from PyPI</h3>
<p>Managing external projects is no fun unless you can benefit from what package authors in neighboring ecosystems have been working on. PyPI is such an ecosystem and you can install any package from PyPI as a Rez package using <code>rez-pipz</code>.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>git clone https://github.com/mottosso/rez-pipz.git
<span style="color: #f8f8f2">cd</span> rez-pipz
rez build --install
</pre></div>

<p>Here's how you use it.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>rez env pipz -- install six
</pre></div>

<ul>
<li>See <a href="https://github.com/mottosso/rez-pipz">rez-pipz</a> for details.</li>
</ul>
<p><br></p>
<h3 id="install-from-scoop">Install from Scoop</h3>
<p>Scoop is a package manager for Windows. It's akin to <a href="">Chocolatey</a>, except packages are portable and doesn't require adminstrative access, which makes it a perfect fit for Rez.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>git clone https://github.com/mottosso/rez-scoopz.git
<span style="color: #f8f8f2">cd</span> rez-scoopz
rez build --install
</pre></div>

<p>Here's how you use it.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>rez env scoopz -- install python
</pre></div>

<ul>
<li>See <a href="https://github.com/mottosso/rez-scoopz">rez-scoopz</a> for details.</li>
</ul>
<p><br></p>
<h2 id="windows-gotchas">Windows Gotchas</h2>
<p>Here are a few things to keep in mind when working with Rez on Windows.</p>
<p><br></p>
<h3 id="alias-on-windows-with-cmd"><code>alias()</code> on Windows with <code>cmd</code></h3>
<ul>
<li>Utilises <code>doskey</code>, which works similar to <code>alias</code> on Linux</li>
<li>Does not work with <code>rez env -- arbitrary command</code></li>
<li>Does not carry across shell, e.g. <code>start</code></li>
<li>Does not respect cmd.exe scope, e.g. <code>cmd /Q /K doskey python=c:\python27\python.exe $*</code> affects parent too</li>
</ul>
<p><br></p>
<h3 id="process-tree">Process Tree</h3>
<p>Virtualenv is one way of using Rez on Windows, and if you do then the <code>rez.exe</code> executable is generated during <code>pip install</code> and works by spawning a <code>python.exe</code> process, also generated by <code>pip</code>, which in turn calls on your system <code>python.exe</code>. Here's what spawning your own Python session from within a Rez context looks like.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/2152766/59964221-e6b48780-94f5-11e9-8300-390d0587f5e3.png" /></p>
<p><br></p>
<h3 id="cmd-and-2000-characters">cmd and 2,000 characters</h3>
<p><code>cmd.exe</code> is both familiar and available on every Windows machine dating back to Windows 95. It does however suffer from one major limitation; environment variables are limited in length to 2,000 characters.</p>
<p>It isn't quite as simple as that, as there is a limit in the Windows API, another limit in <code>conhost.exe</code> and yet another in <code>cmd.exe</code>. When using Rez with <code>cmd.exe</code>, it is this limit you must take into consideration, and it is the most limiting of them all.</p>
<p>To work around this issue, it is recommended that you use PowerShell on Windows.</p>
<p><strong>rezconfig.py</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">default_shell</span> <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&quot;powershell&quot;</span>
</pre></div>

<p><br></p>
<h3 id="platform_map">platform_map</h3>
<p>You'll want to use a brutal <a href="https://github.com/mottosso/bleeding-rez/wiki/Configuring-Rez#platform_map"><code>platform_map</code></a> for your Windows setup, because of stunts like this.</p>
<p><strong>Machine A</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>$ C:<span style="color: #ae81ff">\U</span>sers<span style="color: #ae81ff">\m</span>arcus<span style="color: #ae81ff">\D</span>esktop&gt;systeminfo <span style="color: #f8f8f2">|</span> findstr /B /C:<span style="color: #e6db74">&quot;OS Name&quot;</span> /C:<span style="color: #e6db74">&quot;OS Version&quot;</span>
OS Name:                   Microsoft Windows <span style="color: #ae81ff">10</span> Pro
OS Version:                <span style="color: #ae81ff">10</span>.0.17134 N/A Build <span style="color: #ae81ff">17134</span>
$ python
&gt;&gt;&gt; import platform
&gt;&gt;&gt; platform.platform<span style="color: #f92672">()</span>
<span style="color: #e6db74">&#39;Windows-8-6.2.9200&#39;</span>
&gt;&gt;&gt; from rez.utils.platform_ import platform_
&gt;&gt;&gt; platform_.os
<span style="color: #e6db74">&#39;windows-6.2.9200&#39;</span>
</pre></div>

<p><strong>Machine B</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>$ C:<span style="color: #ae81ff">\U</span>sers<span style="color: #ae81ff">\m</span>arcus<span style="color: #ae81ff">\D</span>esktop&gt;systeminfo <span style="color: #f8f8f2">|</span> findstr /B /C:<span style="color: #e6db74">&quot;OS Name&quot;</span> /C:<span style="color: #e6db74">&quot;OS Version&quot;</span>
OS Name:                   Microsoft Windows <span style="color: #ae81ff">10</span> Pro
OS Version:                <span style="color: #ae81ff">10</span>.0.18362 N/A Build <span style="color: #ae81ff">18362</span>
$ python
&gt;&gt;&gt; import platform
&gt;&gt;&gt; platform.platform<span style="color: #f92672">()</span>
<span style="color: #e6db74">&#39;Windows-10-10.0.18362&#39;</span>
&gt;&gt;&gt; from rez.utils.platform_ import platform_
&gt;&gt;&gt; platform_.os
<span style="color: #e6db74">&#39;windows-10.0.18362.SP0&#39;</span>
</pre></div>

<p><strong>rezconfig.py</strong></p>
<p>For a <code>platform_map</code>, try this one on for size. I'll make any modern version of Windows (8-10) into Windows 10.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">platform_map</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #e6db74">&quot;os&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #e6db74">r&quot;windows-6(.*)&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">r&quot;windows-10&quot;</span><span style="color: #f8f8f2">,</span>
        <span style="color: #e6db74">r&quot;windows-10(.*)&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">r&quot;windows-10&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #f8f8f2">},</span>
<span style="color: #f8f8f2">}</span>
</pre></div>

<p><br></p>
<h3 id="maya-and-quicktime">Maya and Quicktime</h3>
<p>Typically, playblasting to <code>.mp4</code> or <code>.mov</code> with Maya requires a recent install of Quicktime on the local machine. Let's have a look at how to approach this with Rez.</p>
<blockquote>
<p>How <em>does</em> one approach this with Rez? Submit <a href="https://github.com/mottosso/allspark">a PR</a> today!</p>
</blockquote>
<p><br></p>
<h3 id="package-version-and-python">Package version and Python</h3>
<p>Every package containing a payload typically involves two version numbers.</p>
<ul>
<li>Version of the package</li>
<li>Version of the payload</li>
</ul>
<p>Preferably, these would always line up, but how can you expose the version of a package to Python?</p>
<p><strong>package.py</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;my_library&quot;</span>
<span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;1.0&quot;</span>
</pre></div>

<p><strong>my_library/python/my_library.py</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;?&quot;</span>
</pre></div>

<h4 id="1-package-to-python">1. Package to Python</h4>
<p>What if Python was the one defining a version, and <code>package.py</code> picking this up instead? You certainly can, except it moves complexity away from your library and into your <code>package.py</code>, which is generally not a good idea.</p>
<p><strong>package.py</strong></p>
<p>Option 1, plain-text</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;my_library&quot;</span>

<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;python\my_library.py&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">f:</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">startswith(</span><span style="color: #e6db74">&quot;version = &quot;</span><span style="color: #f8f8f2">):</span>
            <span style="color: #f8f8f2">_,</span> <span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">rstrip()</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot; = &quot;</span><span style="color: #f8f8f2">)</span>
            <span style="color: #66d9ef">break</span>
</pre></div>

<p>This works, but makes a few fragile assumptions about how the version is formatted in the file.</p>
<p>Option 2.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;my_library&quot;</span>

<span style="color: #f8f8f2">cwd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getcwd()</span>
<span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">chmod(</span><span style="color: #e6db74">&quot;python&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">my_library</span>
<span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">my_library</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">version</span>
</pre></div>

<p>This is a little ugly, but works. The assumption made is that whatever is being executed in the imported module doesn't have any side effects or negatively impacts performance. Some modules, for example, establish database connections or temporary directories on import.</p>
<p><br></p>
<h4 id="2-embedded">2. Embedded</h4>
<p>This next approach addresses the above concerns in a more compact manner.</p>
<p>In order to use a package, it must first be built. We can leverage this build step to modify a Python library and embed the package version.</p>
<p><strong>my_library/<strong>init</strong>.py</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">try</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f92672">from</span> <span style="color: #f8f8f2">.</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">__version__</span>
    <span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">__version__</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">version</span>
<span style="color: #66d9ef">except</span> <span style="color: #a6e22e">ImportError</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;dev&quot;</span>
</pre></div>

<p>At this point, <code>version</code> will read <code>"dev"</code> until the module <code>__version__.py</code> has been written into the library. We can write this file during build.</p>
<p><strong>package.py</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;my_library&quot;</span>
<span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;1.0&quot;</span>
<span style="color: #f8f8f2">build_command</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;python {root}/install.py&quot;</span>
</pre></div>

<p><strong>install.py</strong></p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">shutil</span>

<span style="color: #f8f8f2">root</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dirname(__file__)</span>
<span style="color: #f8f8f2">build_dir</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">environ[</span><span style="color: #e6db74">&quot;REZ_BUILD_PATH&quot;</span><span style="color: #f8f8f2">]</span>

<span style="color: #75715e"># Copy library</span>
<span style="color: #f8f8f2">shutil</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">copytree(os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(root,</span> <span style="color: #e6db74">&quot;my_library&quot;</span><span style="color: #f8f8f2">),</span>
                <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(build_dir,</span> <span style="color: #e6db74">&quot;my_library&quot;</span><span style="color: #f8f8f2">))</span>

<span style="color: #75715e"># Inject version</span>
<span style="color: #f8f8f2">version_fname</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(build_dir,</span> <span style="color: #e6db74">&quot;my_library&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;__version__.py&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">version</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getenv(</span><span style="color: #e6db74">&quot;REZ_BUILD_PROJECT_VERSION&quot;</span><span style="color: #f8f8f2">)</span>

<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(version_fname,</span> <span style="color: #e6db74">&quot;w&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
    <span style="color: #f8f8f2">f</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(</span><span style="color: #e6db74">&quot;version = </span><span style="color: #ae81ff">\&quot;</span><span style="color: #e6db74">%s</span><span style="color: #ae81ff">\&quot;</span><span style="color: #e6db74">&quot;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">version)</span>
</pre></div>

<p>And there you go. Now the version will read <code>"dev"</code> unless the package has been built, in which case it would read <code>"1.0"</code>.</p>
                
                  
                
              

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../rez/" title="Packaging" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Packaging
              </span>
            </div>
          </a>
        
        
          <a href="../shells/" title="Shells" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Shells
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 mottosso
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>